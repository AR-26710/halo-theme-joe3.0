$(document).ready(function(){const $grid=$("#image-grid").isotope({itemSelector:".grid-item",percentPosition:true,masonry:{columnWidth:".grid-item"}});let page=Number(document.querySelector("#image-grid").getAttribute("data-index"))+1;const totalPage=document.querySelector("#image-grid").getAttribute("data-total");const baseUrl=window.location.origin;const loadingIndicator=document.querySelector(".joe_loading");function loadRealImages(){const gridItems=document.querySelectorAll(".grid-item");const observer=new IntersectionObserver(function(entries,observer){entries.forEach(function(entry){if(entry.isIntersecting){const image=entry.target.querySelector(".lazy-load");if(image){image.src=image.dataset.src;image.classList.remove("lazy-load");observer.unobserve(entry.target);image.onload=function(){$grid.isotope("layout")}}}})},{threshold:.5});gridItems.forEach(function(item){observer.observe(item)})}loadRealImages();const loadPageData=async function(){let url;const currentUrl=window.location.href;if(currentUrl.includes("/photos")&&!currentUrl.includes("?group=")){url=`${baseUrl}/photos/page/${page}`}else if(currentUrl.includes("/photos")&&currentUrl.includes("?group=")){const groupParam=new URLSearchParams(window.location.search).get("group");url=`${baseUrl}/photos/page/${page}?group=${groupParam}`}if(page>totalPage){loadingIndicator.remove();return}fetch(url).then(response=>response.text()).then(html=>{const parser=new DOMParser;const doc=parser.parseFromString(html,"text/html");const nextPageImages=doc.querySelectorAll(".grid-item");if(nextPageImages.length>0){nextPageImages.forEach(image=>{$grid.append(image).isotope("appended",image)});$grid.isotope("layout");loadRealImages();page++;if(page>totalPage){loadingIndicator.remove()}}}).catch(error=>{console.error("Error fetching next page data:",error)})};const observerForLoading=new IntersectionObserver(entries=>{if(entries[0].isIntersecting){loadPageData()}},{threshold:1});try{observerForLoading.observe(loadingIndicator)}catch(e){}$(".joe_photos__filter li").on("click",function(){const filterValue=$(this).attr("data-sjslink");$(this).addClass("active").siblings().removeClass("active");$grid.isotope({filter:function(){const sjselValue=$(this).attr("data-sjsel");return filterValue==="*"||sjselValue===filterValue}})})});