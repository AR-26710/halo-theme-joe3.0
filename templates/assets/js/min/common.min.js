!function(){"use strict";window.encryption=(e=>window.btoa(unescape(encodeURIComponent(e)))),window.decrypt=(e=>decodeURIComponent(escape(window.atob(e))));const commonContext={initMode(){if("scrollRestoration"in history&&(history.scrollRestoration="manual"),"user"!==ThemeConfig.theme_mode)return;const e=$("html"),t=$(".mode-light"),o=$(".mode-dark");let n=localStorage.getItem("data-mode");t[`${"light"===n?"remove":"add"}Class`]("active"),o[`${"light"===n?"add":"remove"}Class`]("active"),$(".joe_action_item.mode").on("click",function(a){a.stopPropagation();try{n=localStorage.getItem("data-mode");let a="";n?(a="light"===n?"dark":"light",t[`${"light"===n?"add":"remove"}Class`]("active"),o[`${"light"===n?"remove":"add"}Class`]("active")):(a="dark",t.removeClass("active"),o.addClass("active")),e.attr("data-mode",a),localStorage.setItem("data-mode",a),commonContext.initCommentTheme()}catch(e){console.log(e)}})},loadingBar:{show(){ThemeConfig.enable_loading_bar&&(NProgress.configure({easing:"ease",speed:500,showSpinner:!1}),NProgress.start())},hide(){ThemeConfig.enable_loading_bar&&NProgress.done(!0)}},initNavbar(){const e=$(".joe_header__above-nav a"),t=$(".panel-side-menu .link");let o=0;const{href:n,pathname:a}=location;e.each((e,t)=>{const i=t.getAttribute("href");(a.includes(i)||n.includes(i))&&(o=e)});const i=e.eq(o);i.addClass("current"),i.parents(".joe_dropdown").length&&i.parents(".joe_dropdown").find(".joe_dropdown__link a").addClass("current"),t.eq(o).addClass("current")},initFooter(){ThemeConfig.enable_footer&&"fixed"===ThemeConfig.footer_position&&$("#Joe").css("margin-bottom",$(".joe_footer").height()+30)},initCommentTheme(){const e=document.getElementsByTagName("halo-comment"),t=document.querySelector("html").getAttribute("data-mode");for(let o=0;o<e.length;o++){const n=e[o].shadowRoot.getElementById("halo-comment");$(n)[`${"light"===t?"remove":"add"}Class`]("dark")}const o=Joe.bloggerGenerateAvatarOpts;(o.textColor&&/var\(--([\w-]+)\)/.test(o.textColor)||o.bgColor&&/var\(--([\w-]+)\)/.test(o.bgColor))&&Joe.replaceAllTextAvatarImage()},initCode(e){const t=$(".page-post pre, .page-journals pre, .page-sheet pre");t.length&&t.each(function(t,o){const n=$(o),a=n.find("code");if(a.length>0){if(e)return void n.find(".code-expander").off("click").on("click",function(e){e.stopPropagation();const t=$(this),o=t.parent("pre").siblings(".toolbar").find(".autofold-tip");o&&o.remove(),t.parent("pre").toggleClass("close")});if(ThemeConfig.enable_code_title&&n.addClass("c_title"),ThemeConfig.enable_code_hr&&n.addClass("c_hr"),ThemeConfig.enable_code_macdot&&n.addClass("c_macdot"),ThemeConfig.enable_code_newline&&n.addClass("c_newline"),ThemeConfig.show_tools_when_hover&&n.addClass("c_hover_tools"),ThemeConfig.enable_code_expander&&(n.prepend('<i class="joe-font joe-icon-arrow-downb code-expander" title="折叠/展开"></i>').addClass("c_expander"),n.find(".code-expander").on("click",function(e){e.stopPropagation();const t=$(this),o=t.parent("pre").siblings(".toolbar").find(".autofold-tip");o&&o.remove(),t.parent("pre").toggleClass("close")})),ThemeConfig.enable_code_copy){const e=n.find('code[class*="language-"]').text(),t=$('<span class="copy-button"><i class="joe-font joe-icon-copy" title="复制代码"></i></span>');new ClipboardJS(t[0],{text:()=>e}).on("success",()=>Qmsg.success("复制成功！")),n.addClass("c_copy").append(t)}}})},foldCode(){$(".page-post").length&&ThemeConfig.enable_code_expander&&ThemeConfig.enable_fold_long_code&&"false"!==PageAttrs.metas_enable_fold_long_code&&$(".page-post pre[class*='language-']").each(function(e,t){const o=$(t);if(o.height()>ThemeConfig.long_code_height){const e=o.siblings(".toolbar").find(".toolbar-item span").eq(0);e.append('<em class="autofold-tip"><已自动折叠></em>'),o.addClass("close")}})},initBaidu(){ThemeConfig.check_baidu_collect&&$("#joe_baidu_record").length&&Utils.request({url:ThemeConfig.BASE_URL+"/halo-api/bd/iscollect",method:"GET",returnRaw:!0,data:{url:ThemeConfig.blog_url+window.location.pathname}}).then(e=>{if(e.data&&e.data.collected)$("#joe_baidu_record").css("color","#67c23a").html("已收录");else if(ThemeConfig.baidu_token){$("#joe_baidu_record").html('<span style="color: #e6a23c">未收录，推送中...</span>');let e=setTimeout(function(){Utils.request({url:ThemeConfig.BASE_URL+"/halo-api/bd/push",method:"POST",returnRaw:!0,data:{site:ThemeConfig.blog_url,token:ThemeConfig.baidu_token,urls:window.location.href}}).then(e=>{0===e.data.success?$("#joe_baidu_record").html('<span style="color: #f56c6c">推送失败，请检查！</span>'):$("#joe_baidu_record").html('<span style="color: #67c23a">推送成功！</span>')}).catch(e=>{console.log(e)}),clearTimeout(e),e=null},1e3)}else{const e=`https://ziyuan.baidu.com/linksubmit/url?sitename=${encodeURI(window.location.href)}`;$("#joe_baidu_record").html(`<a target="_blank" href="${e}" rel="noopener noreferrer nofollow" style="color: #f56c6c">未收录，提交收录</a>`)}}).catch(e=>{console.log(e)})},initMusic(){ThemeConfig.enable_global_music_player&&Utils.request({url:`${ThemeConfig.music_api}?server=${ThemeConfig.music_source}&type=${ThemeConfig.music_player_type}&id=${ThemeConfig.music_list_id}`,type:"GET",returnRaw:!0}).then(e=>{new APlayer({container:document.getElementById("global-aplayer"),fixed:!0,lrcType:0,theme:ThemeConfig.music_player_theme,autoplay:ThemeConfig.music_auto_play,volume:ThemeConfig.music_player_volume,loop:ThemeConfig.music_loop_play,audio:e})}).catch(e=>{console.log(e)})},initPDF(){const e=$("joe-pdf");e.length&&e.each((e,t)=>{const o=$(t);options={src:o.attr("src")||"",width:o.attr("width")||"100%",height:o.attr("height")||"500px"};let n="";n=options.src?`\n      <div class="joe_pdf">\n        <iframe src="${ThemeConfig.BASE_RES_URL}/assets/lib/pdfjs/web/viewer.html?file=${options.src}" style="width:${options.width};height:${options.height}"></iframe>\n      </div>`:"<p>pdf地址未填写！</p>",$(t).replaceWith(n)})},back2Top(){if(!ThemeConfig.enable_back2top)return;const e=$(".joe_action_item.back2top"),t=()=>{const t=document.documentElement.scrollTop||document.body.scrollTop;e[(t>300?"add":"remove")+"Class"]("active")};t(),$(document).on("scroll",Utils.throttle(t,120)),e.on("click",function(e){e.stopPropagation(),$("html,body").animate({scrollTop:0},ThemeConfig.enable_back2top_smooth?500:0)})},initTimeCount(){if(Joe.isMobile||!$(".joe_aside__item.timelife").length)return;let e=[{title:"今日已经过去",endTitle:"小时",num:0,percent:"0%"},{title:"这周已经过去",endTitle:"天",num:0,percent:"0%"},{title:"本月已经过去",endTitle:"天",num:0,percent:"0%"},{title:"今年已经过去",endTitle:"个月",num:0,percent:"0%"}];{let t=+new Date,o=new Date((new Date).toLocaleDateString()).getTime(),n=(t-o)/1e3/60/60,a=n/24*100;e[0].num=parseInt(n),e[0].percent=parseInt(a)+"%"}{let t={0:7,1:1,2:2,3:3,4:4,5:5,6:6},o=t[(new Date).getDay()],n=o/7*100;e[1].num=parseInt(o),e[1].percent=parseInt(n)+"%"}{let t=(new Date).getFullYear(),o=(new Date).getDate(),n=(new Date).getMonth()+1,a=new Date(t,n,0).getDate(),i=o/a*100;e[2].num=o,e[2].percent=parseInt(i)+"%"}{let t=(new Date).getMonth()+1,o=t/12*100;e[3].num=t,e[3].percent=parseInt(o)+"%"}let t="";e.forEach((e,o)=>{t+=`\n\t\t\t\t\t\t<div class="item">\n\t\t\t\t\t\t\t<div class="title">\n\t\t\t\t\t\t\t\t${e.title}\n\t\t\t\t\t\t\t\t<span class="text">${e.num}</span>\n\t\t\t\t\t\t\t\t${e.endTitle}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="progress">\n\t\t\t\t\t\t\t\t<div class="progress-bar">\n\t\t\t\t\t\t\t\t\t<div class="progress-bar-inner progress-bar-inner-${o}" style="width: ${e.percent}"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="progress-percentage">${e.percent}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`}),$(".joe_aside__item.timelife .joe_aside__item-contain").html(t)},initWeather(){var e,t,o,n,a,i,s,l;!Joe.isMobile&&ThemeConfig.enable_weather&&ThemeConfig.weather_token&&$("#tp-weather-widget").length&&(e=window,t=document,o="script",n="SeniverseWeatherWidget",a="//cdn.sencdn.com/widget2/static/js/bundle.js?t="+parseInt(((new Date).getTime()/1e8).toString(),10),l=function(){i=t.createElement(o),s=t.getElementsByTagName(o)[0],i.src=a,i.charset="utf-8",i.async=1,s.parentNode.insertBefore(i,s)},e.SeniverseWeatherWidgetObject=n,e[n]||(e[n]=function(){(e[n].q=e[n].q||[]).push(arguments)}),e[n].l=+new Date,e.attachEvent?e.attachEvent("onload",l):e.addEventListener("load",l,!1),window.SeniverseWeatherWidget("show",{flavor:"slim",location:"WX4FBXXFKE4F",geolocation:!0,language:"zh-Hans",unit:"c",theme:"auto",token:ThemeConfig.weather_token,hover:"disabled",container:"tp-weather-widget"}))},initGallery(){const e=$(".page-post .joe_detail__article img:not([class]), .page-journals .joe_journal_block img:not([class]), .page-sheet img:not([class])");e.length&&e.each(function(){const e=$(this);e.wrap($(`<span style="display: block;" data-fancybox="Joe" href="${e.attr("src")}"></span>`))})},initExternalLink(){let e;if("default"!==ThemeConfig.link_behavior){if(e=$(".joe_main_container a[href]"),!e.length)return;e.each(function(){const e=$(this),t=e.attr("href");if(!t.includes("javascript:;")){let t="";t="new"!==ThemeConfig.link_behavior||e.attr("href").startsWith("#")?"":"_blank",e.attr({target:t,rel:"noopener noreferrer nofollow"})}})}else{if(e=$(".page-post .joe_detail__article a[href], .joe_journal_body a[href], .page-sheet .joe_detail__article a[href]"),!e.length)return;e.each(function(){const e=$(this),t=e.attr("href");if(!t.includes("javascript:;")){const o=t.startsWith("#")?"":"_blank";e.attr({target:o,rel:"noopener noreferrer nofollow"})}})}},init3dCloud(e){const t="tag"===e,o=t?"tags-3d":"categories-3d",n=t?".tags-cloud-list":".categories-cloud-list",a=[],i=["#F8D800","#0396FF","#EA5455","#7367F0","#32CCBC","#F6416C","#28C76F","#9F44D3","#F55555","#736EFE","#E96D71","#DE4313","#D939CD","#4C83FF","#F072B6","#C346C2","#5961F9","#FD6585","#465EFB","#FFC600","#FA742B","#5151E5","#BB4E75","#FF52E5","#49C628","#00EAFF","#F067B4","#F067B4","#ff9a9e","#00f2fe","#4facfe","#f093fb","#6fa3ef","#bc99c4","#46c47c","#f9bb3c","#e8583d","#f68e5f"],s=(e,t)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e);ThemeConfig[`${e}_cloud_type`]=document.getElementById(o)?"3d":"list",ThemeConfig[`enable_${e}_cloud`]=null!==document.querySelector(".joe_aside__item.tags-cloud"),!Joe.isMobile&&ThemeConfig[`enable_${e}_cloud`]&&"3d"===ThemeConfig[`${e}_cloud_type`]&&$(n).length&&$.getScript(`${ThemeConfig.BASE_RES_URL}/assets/lib/3dtag/3dtag.min.js`,e=>{$(n+" a").each((e,t)=>{a.push({label:$(t).attr("data-label"),url:$(t).attr("data-url"),target:"_blank",fontColor:i[s(0,i.length-1)],fontSize:16})}),$(`#${o}`).svg3DTagCloud({entries:a,width:250,height:250,radius:"65%",radiusMin:75,bgDraw:!1,fov:800,speed:.5,fontWeight:500}),$(n).remove(),$(`#${o} .empty`).remove()})},init3dTag(){this.init3dCloud("tag")},init3dCategory(){this.init3dCloud("category")},initDropMenu(){$(".joe_dropdown").each(function(e,t){const o=$(this).find(".joe_dropdown__menu"),n=$(t).attr("trigger")||"click",a=$(t).attr("placement")||$(this).height()||0;o.css("top",a),"hover"===n?$(this).hover(()=>$(this).addClass("active"),()=>$(this).removeClass("active")):($(this).on("click",function(e){e.stopPropagation(),$(this).toggleClass("active"),$(document).one("click",()=>$(this).removeClass("active")),e.stopPropagation()}),o.on("click",e=>e.stopPropagation()))})},drawerMobile(){$(".joe_header__above-slideicon").on("click",function(e){e.stopPropagation(),$(".joe_header__searchout").removeClass("active");const t=$("html"),o=$(".joe_header__mask"),n=$(".joe_header__slideout");n.hasClass("active")?(t.removeClass("disable-scroll"),o.removeClass("active slideout"),n.removeClass("active")):(window.sessionStorage.setItem("lastScroll",t.scrollTop()),t.addClass("disable-scroll"),o.addClass("active slideout"),n.addClass("active"))})},maskClose(){$(".joe_header__mask").on("click",function(e){e.stopPropagation();const t=$("html");t.removeClass("disable-scroll"),$(".joe_header__mask").removeClass("active slideout"),$(".joe_header__searchout").removeClass("active"),$(".joe_header__slideout").removeClass("active"),$(".joe_header__toc").removeClass("active"),$(".joe_header__above").removeClass("solid");const o=window.sessionStorage.getItem("lastScroll");o&&t.scrollTop(o),window.sessionStorage.removeItem("lastScroll")}).on("touchmove",e=>e.preventDefault)},sideMenuMobile(){$(".joe_header__slideout-menu .current").parents(".panel-body").show().siblings(".panel").addClass("in"),$(".joe_header__slideout-menu .panel").on("click",function(e){e.stopPropagation();const t=$(this),o=t.parent().parent();o.find(".panel").not(t).removeClass("in"),o.find(".panel-body").not(t.siblings(".panel-body")).stop().hide("fast"),t.toggleClass("in").siblings(".panel-body").stop().toggle("fast")})},initHeadScroll(){if(Joe.isMobile||ThemeConfig.enable_fixed_header)return;let e=0,t=0;const o=$(".joe_header__above"),n=$(".joe_aside_post, .joe_aside .joe_aside__item:last-child"),a=o.height();if(n)var i=a+15,s=a-60+15;const l=()=>{window.tocPhase||(e=window.scrollY,t<e&&e>a?(o.addClass("active"),n&&n.css("top",s)):t>e&&(o.removeClass("active"),n&&n.css("top",i)),t=e)};document.addEventListener("scroll",Utils.throttle(l,100))},cancelSpaceScroll(){document.body.onkeydown=function(e){e=e||window.event;const t=e.target||e.srcElement,o=e.keyCode||e.charCode;if(32===o){if(["text","input","textarea","halo-comment","halo-comment","comment-widget"].includes(t.tagName.toLowerCase()))return;window.event?e.returnValue=!1:e.preventDefault()}}},scrollToHash(e,t=0){if(e=e||window.decodeURIComponent(location.hash),!e)return;const o=$(".joe_header").height(),n=$(e);if(n&&n.length>0){const e=n.offset().top-o-15;t>0?$("html,body").animate({scrollTop:e},t):document.documentElement.scrollTop=e}},loadMouseEffect(){Joe.isMobile||ThemeConfig.enable_clean_mode||"off"===ThemeConfig.cursor_effect||$.getScript(`${ThemeConfig.BASE_RES_URL}/assets/effect/cursor/${ThemeConfig.cursor_effect}.js`)},loadBackdropEffect(){Joe.isMobile||ThemeConfig.enable_clean_mode||"off"===ThemeConfig.backdrop||$.getScript(`${ThemeConfig.BASE_RES_URL}/assets/effect/backdrop/${ThemeConfig.backdrop}.js`)},setFavicon(){if(!ThemeConfig.favicon)return;const e=new Favico,t=new Image;t.onload=function(){e.image(t)},t.src=ThemeConfig.favicon},offscreenTip(){if(Joe.isMobile||!ThemeConfig.enable_offscreen_tip)return;const e=document.title;let t=null;document.addEventListener("visibilitychange",function(){location.href.indexOf(ThemeConfig.blog_url)>0||"/"!==location.pathname||(document.hidden?(document.title=ThemeConfig.offscreen_title_leave||"歪，你去哪里了？",clearTimeout(t)):(document.title=ThemeConfig.offscreen_title_back||"(つェ⊂)咦，又回来了!",t=setTimeout(function(){document.title=e},2e3)))})},initBirthday(){if(!ThemeConfig.enable_birthday)return;if(!/^\d+$/.test(ThemeConfig.birthday)&&!/^(\d{4}\/\d{1,2}\/\d{1,2}\s\d{1,2}:\d{1,2}(:\d{0,2})?)$/.test(ThemeConfig.birthday))return void Qmsg.error("“自定义博客起始时间” 格式错误，请检查！");const e=new Date(/^\d+$/g.test(ThemeConfig.birthday)?+ThemeConfig.birthday:ThemeConfig.birthday),t=$(".joe_run__day"),o=$(".joe_run__hour"),n=$(".joe_run__minute"),a=$(".joe_run__second"),i=()=>{const i=+new Date,s=i-e.getTime();let l=s/864e5,r=Math.floor(l),c=24*(l-r),d=Math.floor(c),m=60*(c-d),h=Math.floor(m),g=60*(m-h),f=Math.floor(g);l=String(r).padStart(2,0),c=String(d).padStart(2,0),m=String(h).padStart(2,0),g=String(f).padStart(2,0),t.html(l),o.html(c),n.html(m),a.html(g)};i(),setInterval(i,1e3)},showLoadTime(){if(Joe.isMobile||!ThemeConfig.show_loaded_time)return;const e=performance.now();e&&console.log("%c页面加载耗时："+Math.round(e)+" ms","padding: 6px 8px;color:#fff;background:linear-gradient(270deg, #4edb21, #f15206);border-radius: 3px;")},debug(){ThemeConfig.enable_debug&&new window.VConsole},clean(){$("#compatiable-checker").remove(),$("#theme-config-getter").remove(),$("#metas-getter").remove(),$("#theme-config-getter").remove(),commonContext.loadingBar.hide()},travelling(){function e(){const e="/apis/api.plugin.halo.run/v1alpha1/plugins/PluginLinks/links?keyword=";fetch(e).then(e=>e.json()).then(e=>{a.set("links-data",JSON.stringify(e.items),10/1440),o(e.items)})}function t(e,t){if(t>e.length)return null;const o=e.sort(()=>.5-Math.random());return o.slice(0,t)}function o(e){const o=e,n=document.querySelector(".joe_action_item.random");n&&n.addEventListener("click",function(){if(o.length>0){const e=t(o,1),n=e[0].spec.displayName,a=e[0].spec.url,i="即将跳转到：「"+n+"」";Qmsg.success(i),setTimeout(()=>{window.open(a,"_blank")},3e3)}})}function n(){const t=a.get("links-data");t?o(JSON.parse(t)):e()}const a={set:function(e,t,o){const n=new Date,a={value:t,expiry:n.getTime()+6e4*o};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return null;const o=JSON.parse(t),n=new Date;return n.getTime()>o.expiry?(localStorage.removeItem(e),null):o.value}};n()}};!function(){const e=["loadingBar","init3dTag","init3dCategory","foldCode","loadMouseEffect","loadBackdropEffect","setFavicon","initUV","showLoadTime","debug","clean","travelling"];document.addEventListener("DOMContentLoaded",function(){commonContext.loadingBar.show(),Object.keys(commonContext).forEach(t=>!e.includes(t)&&commonContext[t]())}),window.addEventListener("load",function(){1===e.length?commonContext[e[0]]():e.forEach(e=>"loadingBar"!==e&&commonContext[e]&&commonContext[e]())})}(),window.commonContext=commonContext;}();
